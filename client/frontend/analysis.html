<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Analysis - Product Name</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="analysis.css">
</head>
<body>

    <header>
        <nav class="navbar navbar-expand-lg fixed-top mt-3">
            <div class="container">
                <!-- PILL SHELL (FIXED SHAPE) -->
                <div class="w-100 px-4 py-2 border rounded-pill shadow-sm" style="background-color: #626f47">
                    <div class="d-flex align-items-center justify-content-between">
                        <!-- Brand -->
                        <a class="navbar-brand fw-bold text-warning text-nowrap m-0" href="index.html">
                            UnPackEat
                        </a>

                        <!-- Desktop menu -->
                        <ul class="navbar-nav d-none d-lg-flex gap-3 mb-0">
                            <li class="nav-item">
                                <a class="nav-link text-white" href="index.html">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="about.html">About</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="awareness.html">Awareness</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="FAQ.html">FAQ</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="Contribution.html">Contribution</a>
                            </li>
                        </ul>

                        <!-- Right side -->
                        <div class="d-flex align-items-center gap-2">
                            <input class="form-control rounded-pill d-none d-lg-block" type="search" placeholder="Search" />
                            <button class="btn btn-outline-warning rounded-pill d-none d-lg-block">
                                Search
                            </button>

                            <a href="user.html" class="d-flex align-items-center text-white text-decoration-none">
                                <img src="https://github.com/mdo.png" alt="" width="32" height="32" class="rounded-circle me-2" />
                                <strong>User</strong>
                            </a>

                            <!-- Hamburger -->
                            <button class="navbar-toggler d-lg-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#mobileMenu">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- MOBILE MENU -->
                <div class="collapse d-lg-none mt-3 mx-auto" id="mobileMenu" style="max-width: 100%">
                    <div class="card card-body shadow-sm rounded-4 text-center mx-auto" style="max-width: 95%; background-color: #626f47">
                        <ul class="navbar-nav gap-2">
                            <li class="nav-item">
                                <a class="nav-link text-white" href="index.html">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="about.html">About</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="awareness.html">Awareness</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="FAQ.html">FAQ</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="Contribution.html">Contribution</a>
                            </li>
                        </ul>

                        <hr class="border-light" />

                        <input class="form-control rounded-pill mb-2" type="search" placeholder="Search" />
                        <button class="btn btn-outline-light rounded-pill w-100">
                            Search
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="analysis-container">
        <!-- Block 1: Hero Identity -->
        <div class="glass-card block-hero">
            <div class="hero-header">
                <div>
                    <div class="d-flex align-items-center gap-2 mb-1">
                        <h1 id="product-name" class="h3 m-0">Balaji Wafers Crunchex</h1>
                        <div class="gauge-wrapper">
                            <svg class="segmented-gauge" viewBox="0 0 100 100">
                                <defs>
                                    <mask id="gauge-mask">
                                        <circle cx="50" cy="50" r="42" fill="none" stroke="white" stroke-width="12" stroke-dasharray="2 1.5"></circle>
                                    </mask>
                                </defs>
                                <circle class="gauge-track" cx="50" cy="50" r="42" mask="url(#gauge-mask)"></circle>
                                <circle id="gauge-progress" class="gauge-segment-fill" cx="50" cy="50" r="42" mask="url(#gauge-mask)"></circle>
                            </svg>
                            <div class="gauge-center">
                                <span id="health-score" class="score-number">33</span>
                            </div>
                        </div>
                    </div>
                    <p id="product-brand" class="mb-3" style="color: var(--text-muted);">by Balaji</p>
                    <div id="verdict" class="verdict-tag">Limit consumption</div>
                </div>
                <img id="product-image" src="https://images.openfoodfacts.net/images/products/890/601/050/1570/front_en.13.400.jpg" alt="Product" class="product-img">
            </div>
            <div class="mt-4">
                <span class="text-white-50 small d-block mb-1">Portion Insight</span>
                <strong id="portion-calories">174.4 kcal per pack</strong>
            </div>
        </div>

        <!-- Block 2: Nutrition Breakdown -->
        <div class="glass-card block-nutrition">
            <h2 class="section-title">Macro Distribution</h2>
            <div id="macros-container">
                <!-- Dynamic Macros -->
                <div class="nutrition-item">
                    <div class="d-flex justify-content-between small">
                        <span>Fat</span>
                        <span id="fat-percent">50.7%</span>
                    </div>
                    <div class="progress-container">
                        <div id="fat-bar" class="progress-bar" style="width: 50.7%;"></div>
                    </div>
                </div>
                <div class="nutrition-item">
                    <div class="d-flex justify-content-between small">
                        <span>Carbs</span>
                        <span id="carb-percent">40.4%</span>
                    </div>
                    <div class="progress-container">
                        <div id="carb-bar" class="progress-bar" style="width: 40.4%;"></div>
                    </div>
                </div>
                <div class="nutrition-item">
                    <div class="d-flex justify-content-between small">
                        <span>Protein</span>
                        <span id="protein-percent">5.5%</span>
                    </div>
                    <div class="progress-container">
                        <div id="protein-bar" class="progress-bar" style="width: 5.5%;"></div>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <h2 class="section-title">Daily Context</h2>
                <ul id="daily-context-list" class="list-unstyled small" style="color: var(--text-muted); font-weight: 500;">
                    <li>Saturated fat: 14.4g per 100g (recommended limit ~20g/day)</li>
                    <li>Salt: 0.0024g per 100g (recommended limit ~5g/day)</li>
                </ul>
            </div>
        </div>


        <!-- Block 3: Highlights -->
        <div class="glass-card block-highlights">
            <h2 class="section-title">Key Highlights</h2>
            <div class="badge-list" id="positives-list">
                <span class="badge-custom flag-green">High fiber</span>
            </div>
            
            <h2 class="section-title mt-4">Risk Flags</h2>
            <div class="badge-list mb-3" id="risks-list">
                <span class="badge-custom flag-red">High saturated fat</span>
                <span class="badge-custom flag-red">Ultra-processed</span>
                <span class="badge-custom flag-red">High additives</span>
            </div>

            <div id="warnings-list" class="small" style="font-weight: 600;">
                <p class="mb-1 text-danger">⚠️ Contains palm oil</p>
                <p class="mb-0 text-danger">⚠️ Allergens: soy, nuts, milk</p>
            </div>
        </div>

        <!-- Block 4: Main Table (Score Breakdown) -->
        <div class="glass-card block-table">
            <h2 class="section-title">Score Breakdown</h2>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Reason</th>
                        <th>Value</th>
                        <th>Impact</th>
                    </tr>
                </thead>
                <tbody id="score-table-body">
                    <!-- Dynamic Data -->
                    <tr>
                        <td>High saturated fat</td>
                        <td>14.4</td>
                        <td class="text-danger">-10</td>
                    </tr>
                    <tr>
                        <td>Ultra-processed</td>
                        <td>NOVA 4</td>
                        <td class="text-danger">-10</td>
                    </tr>
                    <tr>
                        <td>High fiber</td>
                        <td>9.3g</td>
                        <td class="text-success">+8</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Block 5: Dropdown Details (Other Analysis) -->
        <div class="glass-card block-details">
            <h2 class="section-title">Additional Analysis</h2>
            <div class="accordion accordion-custom" id="detailsAccordion">
                
                <!-- Ingredients -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                            Ingredients Complexity
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#detailsAccordion">
                        <div class="accordion-body">
                            Highly complex formulation. Total components: 40.
                            <br><br>
                            <small class="text-white-50">Ingredients: POTATO (84%), EDIBLE VEGETABLE OIL, SEASONING...</small>
                        </div>
                    </div>
                </div>

                <!-- Additives -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                            Additives (9 Detected)
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#detailsAccordion">
                        <div class="accordion-body">
                            <ul class="list-unstyled mb-0">
                                <li>E160C (Color)</li>
                                <li>E330 (Acidity Regulator)</li>
                                <li>E627 (Flavour Enhancer)</li>
                                <li>...and 6 more</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Meta/EcoScore -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                            Environment & Meta
                        </button>
                    </h2>
                    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#detailsAccordion">
                        <div class="accordion-body">
                            Nova Group: 4 (Ultra-processed)<br>
                            EcoScore: B (Good)<br>
                            Packaging: Plastic
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dynamic Injection Script -->
    <script>
        const fullData = {
          "summary": {
            "health_score": 33,
            "verdict": "Limit consumption",
            "risk_flags": ["High saturated fat", "Ultra-processed food", "High number of additives"],
            "positives": ["High fiber"],
            "warnings": ["Contains palm oil", "Contains allergens: soy, nuts, milk / lactose"],
            "macro_percent_distribution": {
              "fat_percent_calories": 50.7,
              "carb_percent_calories": 40.4,
              "protein_percent_calories": 5.5
            },
            "daily_context": [
              "Saturated fat: 14.4g per 100g (recommended limit ~20g/day)",
              "Salt: 0.0024175g per 100g (recommended limit ~5g/day)"
            ],
            "portion_insight": { "calories_per_pack": 174.4 },
            "score_breakdown": [
              { "reason": "High saturated fat", "impact": -10, "value": 14.4, "threshold": "> 5g per 100g" },
              { "reason": "Ultra-processed (NOVA 4)", "impact": -10, "value": 4, "threshold": "NOVA group 4" },
              { "reason": "Multiple additives", "impact": -5, "value": 9, "threshold": "> 5 additives" },
              { "reason": "High fiber", "impact": 8, "value": 9.3, "threshold": "> 5g per 100g" }
            ],
            "ingredient_complexity": "Highly complex formulation",
            "ai_insights": {
              "explanation": "This product is classified as a highly processed snack. While it provides a significant amount of dietary fiber (9.3g), it is also very high in saturated fats (14.4g) and contains 9 different additives. The combination of high fat and ultra-processing suggests it should be consumed occasionally rather than as a daily staple. The inclusion of palm oil and multiple allergens further lowers its health profile for sensitive individuals.",
              "suggestion": "Consider swapping these wafers for air-popped popcorn seasoned with herbs, or high-fiber roasted foxnuts (Makhana) for a similar crunch with significantly lower saturated fat levels."
            }
          },
          "details": {
            "basic_info": {
              "name": "Balaji Wafers Crunchex",
              "brand": "Balaji",
              "image": "https://images.openfoodfacts.net/images/products/890/601/050/1570/front_en.13.400.jpg"
            },
            "ingredients": {
                "ingredients_text": "POTATO (84%), EDIBLE VEGETABLE OIL (CONTAINS ONE OR MORE OF THE FOLLOWINGS: PALMOLEIN, GROUNDNUT), **SEASONING [SUGAR, MALTODEXTRIN, SALT, SPICES & CONDIMENTS (CHILLI (0.5%), PEPPER), DEHYDRATED VEGETABLE POWDER (ONION, GARLIC, TOMATO), BLACK SALT, ACIDITY REGULATOR (INS 330, INS 296, INS 334), MILK SOLIDS (0.1%), HYDROLYZED VEGETABLE PROTEIN SOYA), ANTICAKING AGENT (INS 551), FLAVOUR ENHANCER (INS 627, INS 631) FLAVOUR (NATURAL & NATURE IDENTICAL FLAVOURING SUBSTANCES), PAPRIKA EXTRACT (INS 160C), STABILIZER (INS 340), EMULSIFIER (INS 470)]",
                "total_count": 40,
                "additives_count": 9,
                "decoded_additives": [
                    { "code": "E160C", "type": "Color" },
                    { "code": "E296", "type": "Acidity regulator" },
                    { "code": "E330", "type": "Acidity regulator" },
                    { "code": "E334", "type": "Acidity regulator" },
                    { "code": "E340", "type": "Stabilizer" },
                    { "code": "E470", "type": "Emulsifier" },
                    { "code": "E551", "type": "Anti-caking agent" },
                    { "code": "E627", "type": "Flavour enhancer" },
                    { "code": "E631", "type": "Flavour enhancer" }
                ]
            },
            "meta": {
                "nova_group": 4,
                "ecoscore_grade": "b",
                "packaging_materials": ["en:plastic"]
            }
          }
        };

        function populatePage(data) {
            // Basic Info
            document.getElementById('product-name').innerText = data.details.basic_info.name;
            document.getElementById('product-brand').innerText = `by ${data.details.basic_info.brand}`;
            document.getElementById('health-score').innerText = data.summary.health_score;
            document.getElementById('verdict').innerText = data.summary.verdict;
            document.getElementById('product-image').src = data.details.basic_info.image;
            document.getElementById('portion-calories').innerText = `${data.summary.portion_insight.calories_per_pack} kcal per pack`;

            // Gauge Animation
            const score = data.summary.health_score;
            const circumference = 263.89; // 2 * PI * 42
            const offset = circumference - (score / 100) * circumference;
            setTimeout(() => {
                const progressCircle = document.getElementById('gauge-progress');
                if (progressCircle) progressCircle.style.strokeDashoffset = offset;
            }, 300);

            // Macros
            document.getElementById('fat-percent').innerText = data.summary.macro_percent_distribution.fat_percent_calories + '%';
            document.getElementById('carb-percent').innerText = data.summary.macro_percent_distribution.carb_percent_calories + '%';
            document.getElementById('protein-percent').innerText = data.summary.macro_percent_distribution.protein_percent_calories + '%';
            
            setTimeout(() => {
                document.getElementById('fat-bar').style.width = data.summary.macro_percent_distribution.fat_percent_calories + '%';
                document.getElementById('carb-bar').style.width = data.summary.macro_percent_distribution.carb_percent_calories + '%';
                document.getElementById('protein-bar').style.width = data.summary.macro_percent_distribution.protein_percent_calories + '%';
            }, 300);

            // Daily Context
            const contextList = document.getElementById('daily-context-list');
            contextList.innerHTML = data.summary.daily_context.map(item => `<li>${item}</li>`).join('');

            // Positives & Risks
            document.getElementById('positives-list').innerHTML = data.summary.positives.map(p => `<span class="badge-custom flag-green">${p}</span>`).join('');
            document.getElementById('risks-list').innerHTML = data.summary.risk_flags.map(r => `<span class="badge-custom flag-red">${r}</span>`).join('');
            document.getElementById('warnings-list').innerHTML = data.summary.warnings.map(w => `<p class="mb-1 small">⚠️ ${w}</p>`).join('');

            // Score Table
            const tableBody = document.getElementById('score-table-body');
            tableBody.innerHTML = data.summary.score_breakdown.map(item => `
                <tr>
                    <td>${item.reason}</td>
                    <td>${item.value}</td>
                    <td class="${item.impact < 0 ? 'text-danger' : 'text-success'}" style="font-weight: 700;">${item.impact > 0 ? '+' : ''}${item.impact}</td>
                </tr>
            `).join('');

            // Accordion Details
            // 1. Ingredients
            document.querySelector('#collapseOne .accordion-body').innerHTML = `
                <strong>${data.summary.ingredient_complexity}</strong><br>
                Total components: ${data.details.ingredients.total_count}<br><br>
                <p class="small" style="color: var(--text-muted);">${data.details.ingredients.ingredients_text}</p>
            `;
            // 2. Additives
            document.getElementById('collapseTwo').previousElementSibling.querySelector('button').innerText = `Additives (${data.details.ingredients.additives_count} Detected)`;
            document.querySelector('#collapseTwo .accordion-body').innerHTML = `
                <ul class="list-unstyled mb-0">
                    ${data.details.ingredients.decoded_additives.map(a => `<li><strong>${a.code}</strong>: ${a.type}</li>`).join('')}
                </ul>
            `;
            // 3. Meta
            document.querySelector('#collapseThree .accordion-body').innerHTML = `
                Nova Group: ${data.details.meta.nova_group}<br>
                EcoScore: ${data.details.meta.ecoscore_grade.toUpperCase()}<br>
                Packaging: ${data.details.meta.packaging_materials.join(', ')}
            `;

        }

        document.addEventListener('DOMContentLoaded', () => populatePage(fullData));
    </script>
</body>
</html>
